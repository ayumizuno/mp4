---
title: "mp4"
author: "Sunnie Ning & Ayumi Mizuno"
date: "November 27, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r message= FALSE, warning=FALSE}
library(mdsr)
library(RMySQL)
library(dplyr)
library(ggplot2)
library(stringr)
library(ggthemes)

db <- dbConnect_scidb(dbname = "imdb")
```
```{r ECHO=FALSE}
disney <- db %>%
  dbGetQuery("SELECT DISTINCT (t.id),t.title, t.production_year, mi.info, mi3.info FROM company_name cn
              JOIN movie_companies mc ON mc.company_id = cn.id
              JOIN title t ON mc.movie_id = t.id
              JOIN movie_info mi on mi.movie_id = t.id
              JOIN movie_info mi2 on mi2.movie_id = t.id
              JOIN movie_info mi3 on mi3.movie_id = t.id
              WHERE cn.name LIKE '%Walt Disney%'
              AND t.kind_id = 1
              AND mi.info_type_id=105
             AND mi2.info_type_id = 3
            AND mi2.info = 'Animation'
            AND mi3.info_type_id=107
              AND mi3.info LIKE '%(USA)'")

colnames(disney)[4]= "budget"
colnames(disney)[5]= "gross"
save(disney,file = "Disney.rda")
```

```{r}
load("Disney.rda")
```
```{r}

disney_clean <- disney %>% 
  filter(id != 3792055 & id != 3968288) %>%
  select(-id) %>%
  arrange(production_year) %>% 
  mutate(gross = str_extract(strsplit(gross,' '),"[[0-9]+,]+")) %>% 
  mutate(gross = as.numeric(gsub(",","",gross))) %>% 
  mutate(budget= str_extract(strsplit(budget,' '),"[[0-9]+,]+")) %>% 
  mutate(budget = as.numeric(gsub(",","",budget)))

```
```{r}
disney_clean_bar <- disney_clean%>% 
  gather(key = 'type', value = 'amount',budget, gross)
```

```{r}
p<- ggplot(data = disney_clean_bar, aes(x =production_year, y=amount))+
  geom_bar(stat="identity", aes(fill = type), position = 'dodge')
  
p
```





```{r}
disney_clean <- disney_clean %>%
  mutate(decade = (production_year %/% 10)*10, profit = gross-budget) 
```

```{r}
p2<-ggplot(disney_clean,aes(x =budget, y = gross)) +
  geom_point(aes(color = factor(decade)))+
  scale_color_discrete(labels = c('1930', '1940', '1950', '1960', '1970', '1980', '1990', '2000', '2010'))+
  geom_smooth(method = 'lm') +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  xlab("Budget ($)")+
  ylab("Gross ($)")+
  ggtitle("Gross and Budget of Movies by Decade")+
  theme(legend.title=element_blank())+
  scale_color_brewer(palette="Greens")

p2
```

```{r}
disney_point <- disney_clean %>%
  select(decade, title, profit) %>%
  group_by(decade) %>%
  summarize(medProfit = median(profit))
```

```{r}
p3<-ggplot(disney_point,aes(x=factor(decade), y = medProfit)) +
  geom_bar(stat="identity", fill="darkblue")+
  scale_y_continuous(labels = scales::comma) +
  xlab("")+
  ylab("Profit ($)")+
  ggtitle("Median Profit Earned by Decade")
p3
```
```{r}
top20profit <- disney_clean %>%
  arrange(desc(profit)) %>%
  head(20)

```
```{r}
profit_plot <- ggplot(top20profit, aes(x=reorder(title, profit), y=profit))+
  geom_bar(stat="identity", aes(fill=factor(decade)))+
  geom_point(aes(y=budget), color="red")+
  annotate("text", x = "Finding Nemo", y = 120000000, label = "budget", color="red")+
  geom_text(aes(label=paste("$", profit%/%1000000, "m",sep=""), hjust=0))+
  scale_y_continuous(limits = c(0, 3.5e+08), expand=c(0,0),labels = scales::comma) +
  ggtitle("Top 20 Profitable Movies")+
  xlab("")+
  ylab("Profit ($)")+
  coord_flip()+
  scale_fill_brewer(palette="GnBu")+
  theme(legend.title=element_blank())


profit_plot
```
If we take the top 20 profitable Disney animations, we find that in general, the most profitable movies are the ones that have been produced recently. The top of the chart is dominated by movies produced in the 2000s and 2010s, with *Finding Nemo* and *Fining Dory* taking the top two spots.

Looking at the top 20 profitable Disney Animations, one might notice that the top five movies with the highest budget were all produced in the 2010s: *Finding Dory*, *Inside Out*, *Zootopia*, *Frozen*, and *Moana*. 

The general increase in budgets of animations over the past decades may be attributed to the rise in expensive, new technologies that have the ability to boost the quality of these animations. Producing animations requires software engineers as well as graphic artists in addition to actors who are only used for the characters' voices. 

However, the expensive cost of producing an animation may be worth investing in. 

"Animated films still offer the largest risk/reward equation in the movie business", says Kyle Stock of *Bloomberg News*.

According to *The Seattle Times*, though animations are the most expensive to produce, animations are also the most profitable movie genre. Although a high budget animation is a risk, spending more to produce a quality piece may result in favorable earnings such as *Finding Dory* was able to do. 

Source: https://www.seattletimes.com/business/animated-movies-hit-high-point-so-do-studios-costs-potential-rewards/

Interestingly, before recent decades, the budget of an animation did not seem to have much influence on how well the film performed. Although all of the movies in the top 20 produced during and before the 1960s had low budgets, they were extremely profitable. 

Take, for example, *Snow White and the Seven Dwarfs*, produced in 1937, which is the most profitable Disney animation before the 1990s. The success of this animation despite its low budget may be due to the fact that the film was the first full-length animation and the first Walt Disney Animation Studios film. The significant context of this film's production explains its popularity and high profit earnings that continue to compete with movies produced today. 

source: https://en.wikipedia.org/wiki/Traditional_animation

Another notable movie is *The Lion King*, which had the lowest budget out of the top 3 most profitable movies and made greater profit than *Frozen*. *The Lion King*, produced in 1994, had a budget of 45 million dollars while the film earned a profit of roughly 267 million dollars. Although the film was a great success, before its release, Disney did not have high expectations for the film. Since *The Lion King* featured animals rather than people, many believed that the film would be a failure compared to *Pochahontas*, which was also to be released aroudn the same time. 

There are various factors that led to the unexpected success of *The Lion King*. One significant reason is that the story of the film, which was Disney's first story created just for the film, featured a setting in Africa and distanced itself from the traditional European style settings. Instead of princesses and castles, the focus on lions in Africa may have helped widen the audience.  

source:https://www.tor.com/2015/06/19/the-lion-king-was-the-most-unlikely-success-story-you-will-ever-hear/#

Despite low budgets, Disney was able to produce several films that were highly profitable. This suggests that a film's success depends on more than simply its budget. Though the extent to which this is true today is unclear, the surroudning context and the driving story of the films are also important and may play a large role in helping to draw audiences in.   

